# Chat ç•Œé¢æ¸è¿›å¼ä¼˜åŒ– - å®Œæ•´æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½çš„å‰æä¸‹ï¼Œé€æ­¥æå‡èŠå¤©ç•Œé¢çš„ç”¨æˆ·ä½“éªŒã€‚

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### Phase 1: Token ç”¨é‡æç¤º + è¾“å…¥ä¼˜åŒ– âœ…

#### 1. æ–°å¢ `useTokenUsage` Hook
**æ–‡ä»¶**: `frontend/src/hooks/useTokenUsage.js`

**åŠŸèƒ½**:
- å®æ—¶è¿½è¸ªå¯¹è¯ Token ä½¿ç”¨é‡
- ä¼°ç®—å‰©ä½™å¯ç”¨ Token
- æä¾›ä½¿ç”¨ç‡è­¦å‘Šï¼ˆç»¿è‰²/é»„è‰²/çº¢è‰²ï¼‰
- æ”¯æŒä¸åŒæ¨¡å‹çš„ä¸Šä¸‹æ–‡é™åˆ¶

#### 2. å¢å¼º `ChatInput` ç»„ä»¶
**æ–‡ä»¶**: `frontend/src/components/chat/ChatInput.jsx`

**æ–°å¢åŠŸèƒ½**:
- **Token è¿›åº¦æ¡**: æ˜¾ç¤ºä¸Šä¸‹æ–‡ä½¿ç”¨è¿›åº¦ï¼Œé¢œè‰²éšä½¿ç”¨ç‡å˜åŒ–
- **å­—ç¬¦ç»Ÿè®¡**: æ˜¾ç¤ºå½“å‰è¾“å…¥çš„å­—ç¬¦æ•°å’Œé¢„ä¼° Token æ•°
- **çŠ¶æ€æ ‡ç­¾**: æ˜¾ç¤º"æ­£å¸¸ä½¿ç”¨"/"ä½¿ç”¨é‡è¾ƒé«˜"/"æ¥è¿‘é™åˆ¶"

#### 3. é›†æˆåˆ° ChatInterfaceMinimal
**æ–‡ä»¶**: `frontend/src/components/ChatInterfaceMinimal.jsx`

- å¯¼å…¥ `useTokenUsage` hook
- å°† `tokenUsage` ä¼ é€’ç»™ `ChatInput` ç»„ä»¶

---

### Phase 2: æ¶ˆæ¯æ—¶é—´æˆ³ä¼˜åŒ– âœ…

#### 1. æ–°å¢æ—¶é—´æ ¼å¼åŒ–å·¥å…·
**æ–‡ä»¶**: `frontend/src/utils/timeFormat.js`

**åŠŸèƒ½**:
- `formatRelativeTime()` - ç›¸å¯¹æ—¶é—´ï¼ˆ"åˆšåˆš"/"2åˆ†é’Ÿå‰"/"1å°æ—¶å‰"ï¼‰
- `formatTime()` - æ ¼å¼åŒ–ä¸º HH:mm
- `formatDateTime()` - å®Œæ•´æ—¥æœŸæ—¶é—´
- `formatDuration()` - æŒç»­æ—¶é—´

#### 2. ä¼˜åŒ– `UserMessage` å’Œ `AssistantMessage` ç»„ä»¶
**æ–‡ä»¶**: 
- `frontend/src/components/messages/UserMessage.jsx`
- `frontend/src/components/messages/AssistantMessage.jsx`

**æ”¹è¿›**:
- æ—¶é—´æˆ³æ”¹ä¸ºç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆ"2åˆ†é’Ÿå‰"ï¼‰
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå®Œæ•´æ—¶é—´
- æ—¶é—´ä½ç½®è°ƒæ•´åˆ°ç”¨æˆ·åæ—è¾¹

---

### Phase 3: æ¶ˆæ¯çŠ¶æ€ + @ æåŠ + Tab æ•´ç† âœ…

#### 1. æ¶ˆæ¯å‘é€çŠ¶æ€æŒ‡ç¤ºå™¨

**æ–‡ä»¶ä¿®æ”¹**:
- `frontend/src/hooks/useChatState.js` - æ·»åŠ æ¶ˆæ¯çŠ¶æ€ç®¡ç†
- `frontend/src/components/messages/UserMessage.jsx` - æ˜¾ç¤ºçŠ¶æ€ UI
- `frontend/src/components/ChatInterfaceMinimal.jsx` - é›†æˆçŠ¶æ€æ›´æ–°

**åŠŸèƒ½**:
- å‘é€ä¸­: æ˜¾ç¤ºè“è‰²æ—‹è½¬å›¾æ ‡ + "å‘é€ä¸­"
- å·²å‘é€: æ˜¾ç¤ºç»¿è‰²å¯¹å‹¾ + "å·²å‘é€"
- å‘é€å¤±è´¥: æ˜¾ç¤ºçº¢è‰²é”™è¯¯ + "ç‚¹å‡»é‡è¯•"

**UI é¢„è§ˆ**:
```
[ç”¨æˆ·æ¶ˆæ¯å†…å®¹]
~45 tokens                    å‘é€ä¸­ âŸ³
                               å·²å‘é€ âœ“
                               å‘é€å¤±è´¥ âœ— Â· é‡è¯•
```

#### 2. @ æåŠåŠŸèƒ½ï¼ˆå¼•ç”¨æ–‡ä»¶ï¼‰

**æ–°å¢æ–‡ä»¶**:
- `frontend/src/components/chat/MentionPicker.jsx` - æ–‡ä»¶é€‰æ‹©å™¨

**æ–‡ä»¶ä¿®æ”¹**:
- `frontend/src/components/chat/ChatInput.jsx` - é›†æˆ @ æåŠæ£€æµ‹

**åŠŸèƒ½**:
- è¾“å…¥ `@` è§¦å‘æ–‡ä»¶é€‰æ‹©å™¨
- å®æ—¶è¿‡æ»¤é¡¹ç›®æ–‡ä»¶
- é”®ç›˜å¯¼èˆªï¼ˆâ†‘â†“é€‰æ‹©ï¼ŒEnterç¡®è®¤ï¼ŒEscå…³é—­ï¼‰
- è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶è·¯å¾„åˆ°è¾“å…¥æ¡†

**ä½¿ç”¨æ–¹å¼**:
```
ç”¨æˆ·: @src/components/App.jsx è¿™ä¸ªæ–‡ä»¶æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ
AI: [åˆ†æ App.jsx çš„å†…å®¹å¹¶å›ç­”]
```

**UI é¢„è§ˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©æ–‡ä»¶å¼•ç”¨                â†‘â†“é€‰æ‹© Enterç¡®è®¤ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ src/components/App.jsx               â”‚
â”‚ ğŸ“„ src/utils/api.js                     â”‚
â”‚ ğŸ“„ src/hooks/useChat.js                 â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰¾åˆ° 15 ä¸ªæ–‡ä»¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. æ™ºèƒ½ Tab æ æ•´ç†

**æ–°å¢æ–‡ä»¶**:
- `frontend/src/components/SmartTabBar.jsx` - æ™ºèƒ½ Tab æ ç»„ä»¶

**æ–‡ä»¶ä¿®æ”¹**:
- `frontend/src/components/MainContent.jsx` - æ›¿æ¢åŸæœ‰ Tab æ 

**ä¼˜åŒ–é€»è¾‘**:
- **æ ¸å¿ƒåŠŸèƒ½**ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰: Chatã€Shellã€Filesã€Source Controlã€Tasks
- **é«˜çº§åŠŸèƒ½**ï¼ˆæŠ˜å åˆ°"æ›´å¤š"ï¼‰: RAGã€Smart Reqã€Databaseã€Workflowã€Interview

**UI é¢„è§ˆ**:
```
[Chat] [Shell] [Files] [Source Control] [Tasks] [æ›´å¤šÂ·Â·Â·]
                                      â†‘
                                      ç‚¹å‡»å±•å¼€:
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ é«˜çº§åŠŸèƒ½                 â”‚
                                      â”‚ ğŸ“„ RAG          æ£€ç´¢å¢å¼º â”‚
                                      â”‚ ğŸ§  Smart Req    éœ€æ±‚åˆ†æ â”‚
                                      â”‚ ğŸ—„ï¸ Database     æ•°æ®åº“   â”‚
                                      â”‚ âš™ï¸ Workflow     å·¥ä½œæµ   â”‚
                                      â”‚ ğŸ’¬ Interview    é¢è¯•å‡†å¤‡ â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å®Œæ•´ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| åŠŸèƒ½ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| Token æç¤º | âŒ æ—  | âœ… è¿›åº¦æ¡ + ç™¾åˆ†æ¯” + çŠ¶æ€ |
| å­—ç¬¦ç»Ÿè®¡ | âŒ æ—  | âœ… å­—ç¬¦æ•° + Token ä¼°ç®— |
| æ—¶é—´æ˜¾ç¤º | å›ºå®šæ—¶é—´ | âœ… ç›¸å¯¹æ—¶é—´ (2åˆ†é’Ÿå‰) |
| æ¶ˆæ¯çŠ¶æ€ | âŒ æ—  | âœ… å‘é€ä¸­/å·²å‘é€/å¤±è´¥ |
| @ æåŠ | âŒ æ—  | âœ… æ–‡ä»¶å¿«é€Ÿå¼•ç”¨ |
| Tab æ  | 9ä¸ª Tab æ‹¥æŒ¤ | âœ… æ ¸å¿ƒ + æŠ˜å èœå• |

---

## ğŸ“ å®Œæ•´æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
frontend/src/
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useTokenUsage.js              [æ–°å¢] Token ç”¨é‡è¿½è¸ª
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ timeFormat.js                 [æ–°å¢] æ—¶é—´æ ¼å¼åŒ–
â””â”€â”€ components/
    â”œâ”€â”€ chat/
    â”‚   â””â”€â”€ MentionPicker.jsx         [æ–°å¢] @ æåŠé€‰æ‹©å™¨
    â””â”€â”€ SmartTabBar.jsx               [æ–°å¢] æ™ºèƒ½ Tab æ 
```

### ä¿®æ”¹æ–‡ä»¶
```
frontend/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatInterfaceMinimal.jsx      [ä¿®æ”¹] é›†æˆ Token/çŠ¶æ€
â”‚   â”œâ”€â”€ MainContent.jsx               [ä¿®æ”¹] æ™ºèƒ½ Tab æ 
â”‚   â””â”€â”€ chat/
â”‚       â””â”€â”€ ChatInput.jsx             [ä¿®æ”¹] Token/æåŠ
â”‚   â””â”€â”€ messages/
â”‚       â”œâ”€â”€ UserMessage.jsx           [ä¿®æ”¹] æ—¶é—´/çŠ¶æ€
â”‚       â””â”€â”€ AssistantMessage.jsx      [ä¿®æ”¹] ç›¸å¯¹æ—¶é—´
â””â”€â”€ hooks/
    â””â”€â”€ useChatState.js               [ä¿®æ”¹] æ¶ˆæ¯çŠ¶æ€
```

---

## ğŸ¨ æœ€ç»ˆ UI æ•ˆæœ

### è¾“å…¥åŒºåŸŸ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸Šä¸‹æ–‡: 1,234 / 128,000 tokens [æ­£å¸¸ä½¿ç”¨]        â”‚
â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ @src/components/App.jsx è¿™ä¸ªç»„ä»¶å¦‚ä½•ä¼˜åŒ–ï¼Ÿ       â”‚
â”‚                                            [å‘é€]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Enter å‘é€ Â· Shift+Enter æ¢è¡Œ    45 å­—ç¬¦ (~12t) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶ˆæ¯åˆ—è¡¨
```
[å¤´åƒ] You              åˆšåˆš
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @src/components/App.jsx è¿™ä¸ªç»„ä»¶å¦‚ä½•ä¼˜åŒ–ï¼Ÿ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
~45 tokens                      å·²å‘é€ âœ“

[å¤´åƒ] IFlow            åˆšåˆš
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘æ¥å¸®ä½ åˆ†æ App.jsx ç»„ä»¶...                   â”‚
â”‚                                               â”‚
â”‚ 1. å¯ä»¥ä½¿ç”¨ React.memo ä¼˜åŒ–æ¸²æŸ“...            â”‚
â”‚ 2. å»ºè®®å°†å¤§ç»„ä»¶æ‹†åˆ†ä¸ºå°ç»„ä»¶...                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
~128 tokens
```

### Tab æ 
```
[Chat] [Shell] [Files] [Source Control] [æ›´å¤šâ–¼]
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        RAG              æ£€ç´¢å¢å¼º â”‚
                        Smart Req        éœ€æ±‚åˆ†æ â”‚
                        Database         æ•°æ®åº“   â”‚
                        Workflow         å·¥ä½œæµ   â”‚
                        Interview        é¢è¯•å‡†å¤‡ â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éªŒè¯æ–¹å¼

1. **å¯åŠ¨å‰ç«¯**:
   ```bash
   cd frontend
   npm run dev
   ```

2. **æµ‹è¯• Token æç¤º**:
   - çœ‹è¾“å…¥æ¡†ä¸Šæ–¹çš„ Token è¿›åº¦æ¡
   - è¾“å…¥æ–‡å­—ï¼Œè§‚å¯Ÿå­—ç¬¦ç»Ÿè®¡å˜åŒ–

3. **æµ‹è¯•æ¶ˆæ¯çŠ¶æ€**:
   - å‘é€æ¶ˆæ¯ï¼Œè§‚å¯Ÿ"å‘é€ä¸­"â†’"å·²å‘é€"

4. **æµ‹è¯• @ æåŠ**:
   - è¾“å…¥ `@` çœ‹æ–‡ä»¶é€‰æ‹©å™¨
   - é€‰æ‹©æ–‡ä»¶ï¼Œè‡ªåŠ¨è¡¥å…¨è·¯å¾„

5. **æµ‹è¯• Tab æ **:
   - ç‚¹å‡»"æ›´å¤š"çœ‹ä¸‹æ‹‰èœå•
   - é€‰æ‹© RAG/Database ç­‰åŠŸèƒ½

---

## ğŸ‰ æœ€ç»ˆæ€»ç»“

æœ¬æ¬¡é‡‡ç”¨**æ¸è¿›å¼**ä¼˜åŒ–ï¼Œåˆ† 3 ä¸ªé˜¶æ®µå®Œæˆï¼š

### Phase 1: åŸºç¡€ä¼˜åŒ– âœ…
- Token ç”¨é‡æç¤º
- å­—ç¬¦ç»Ÿè®¡
- æ—¶é—´æ˜¾ç¤ºä¼˜åŒ–

### Phase 2: ä½“éªŒä¼˜åŒ– âœ…
- ç›¸å¯¹æ—¶é—´æ˜¾ç¤º
- æ—¶é—´æ‚¬åœæç¤º

### Phase 3: åŠŸèƒ½å¢å¼º âœ…
- æ¶ˆæ¯å‘é€çŠ¶æ€
- @ æåŠåŠŸèƒ½
- Tab æ æ•´ç†

**æ‰€æœ‰ä¿®æ”¹éƒ½ä¿æŒå‘åå…¼å®¹ï¼Œç°æœ‰åŠŸèƒ½å®Œå…¨ä¸å—å½±å“ï¼**

**ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š**
- ğŸ“Š æ¸…æ¥šäº†è§£ Token ä½¿ç”¨æƒ…å†µ
- â±ï¸ çœ‹åˆ°å‹å¥½çš„ç›¸å¯¹æ—¶é—´
- ğŸ“¤ çŸ¥é“æ¶ˆæ¯å‘é€çŠ¶æ€
- @ï¸ å¿«é€Ÿå¼•ç”¨é¡¹ç›®æ–‡ä»¶
- ğŸ—‚ï¸ ä½¿ç”¨æ›´ç®€æ´çš„ Tab æ 

---

*ä¼˜åŒ–å®Œæˆæ—¶é—´: 2026-01-28*
*ä¼˜åŒ–æ–¹å¼: æ¸è¿›å¼ï¼Œé›¶ç ´å*
*ä¼˜åŒ–é˜¶æ®µ: Phase 1-3 å…¨éƒ¨å®Œæˆ*
